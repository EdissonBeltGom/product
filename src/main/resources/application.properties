# Configuración del servidor
server.port=8090
server.servlet.context-path=/ProductsApi

# Configuración de datos
app.data.file.path=data/products.json

# Configuración de encoding UTF-8
spring.http.encoding.charset=UTF-8
spring.http.encoding.enabled=true
spring.http.encoding.force=true

# Configuración de Jackson para JSON
spring.jackson.default-property-inclusion=non_null
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.serialization.write-date-timestamps-as-nanoseconds=false
spring.jackson.locale=es
spring.jackson.time-zone=America/Bogota

# Configuración de Swagger
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operations-sorter=method
springdoc.swagger-ui.tags-sorter=alpha

# Configuración de logging
logging.level.com.item.product=DEBUG
logging.level.org.springframework.web=DEBUG

# =============================================================================
# CONFIGURACIÓN DE RESILIENCE4J - CIRCUIT BREAKER
# =============================================================================

# Configuración general de Resilience4j
resilience4j.circuitbreaker.configs.default.register-health-indicator=true
resilience4j.circuitbreaker.configs.default.sliding-window-size=10
resilience4j.circuitbreaker.configs.default.minimum-number-of-calls=5
resilience4j.circuitbreaker.configs.default.failure-rate-threshold=50
resilience4j.circuitbreaker.configs.default.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.configs.default.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.configs.default.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.circuitbreaker.configs.default.record-exceptions=java.lang.RuntimeException,java.lang.Exception
resilience4j.circuitbreaker.configs.default.ignore-exceptions=java.lang.IllegalArgumentException

# Configuración específica para productService
resilience4j.circuitbreaker.instances.productService.sliding-window-size=10
resilience4j.circuitbreaker.instances.productService.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.productService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.productService.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.productService.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.productService.record-exceptions=java.lang.RuntimeException,java.lang.Exception
resilience4j.circuitbreaker.instances.productService.ignore-exceptions=java.lang.IllegalArgumentException

# Configuración específica para similarProductsService
resilience4j.circuitbreaker.instances.similarProductsService.sliding-window-size=15
resilience4j.circuitbreaker.instances.similarProductsService.minimum-number-of-calls=8
resilience4j.circuitbreaker.instances.similarProductsService.failure-rate-threshold=40
resilience4j.circuitbreaker.instances.similarProductsService.wait-duration-in-open-state=45s
resilience4j.circuitbreaker.instances.similarProductsService.permitted-number-of-calls-in-half-open-state=5
resilience4j.circuitbreaker.instances.similarProductsService.record-exceptions=java.lang.RuntimeException,java.lang.Exception
resilience4j.circuitbreaker.instances.similarProductsService.ignore-exceptions=java.lang.IllegalArgumentException

# =============================================================================
# CONFIGURACIÓN DE RESILIENCE4J - RATE LIMITING
# =============================================================================

# Configuración general de Rate Limiting
resilience4j.ratelimiter.configs.default.limit-for-period=100
resilience4j.ratelimiter.configs.default.limit-refresh-period=1m
resilience4j.ratelimiter.configs.default.timeout-duration=5s
resilience4j.ratelimiter.configs.default.register-health-indicator=true

# Rate Limiting específico para endpoints de productos
resilience4j.ratelimiter.instances.productEndpoint.limit-for-period=50
resilience4j.ratelimiter.instances.productEndpoint.limit-refresh-period=1m
resilience4j.ratelimiter.instances.productEndpoint.timeout-duration=3s

# Rate Limiting para usuarios generales
resilience4j.ratelimiter.instances.userRateLimit.limit-for-period=200
resilience4j.ratelimiter.instances.userRateLimit.limit-refresh-period=1h
resilience4j.ratelimiter.instances.userRateLimit.timeout-duration=10s

# Rate Limiting para usuarios premium
resilience4j.ratelimiter.instances.premiumUserRateLimit.limit-for-period=500
resilience4j.ratelimiter.instances.premiumUserRateLimit.limit-refresh-period=1h
resilience4j.ratelimiter.instances.premiumUserRateLimit.timeout-duration=5s

# Rate Limiting para productos similares (más restrictivo)
resilience4j.ratelimiter.instances.similarProductsRateLimit.limit-for-period=30
resilience4j.ratelimiter.instances.similarProductsRateLimit.limit-refresh-period=1m
resilience4j.ratelimiter.instances.similarProductsRateLimit.timeout-duration=2s

# Rate Limiting para búsquedas
resilience4j.ratelimiter.instances.searchRateLimit.limit-for-period=100
resilience4j.ratelimiter.instances.searchRateLimit.limit-refresh-period=5m
resilience4j.ratelimiter.instances.searchRateLimit.timeout-duration=5s


# Configuración de Retry
resilience4j.retry.configs.default.max-attempts=3
resilience4j.retry.configs.default.wait-duration=1s
resilience4j.retry.configs.default.retry-exceptions=java.lang.RuntimeException,java.lang.Exception
resilience4j.retry.configs.default.ignore-exceptions=java.lang.IllegalArgumentException

# Configuración específica de Retry para productService
resilience4j.retry.instances.productService.max-attempts=3
resilience4j.retry.instances.productService.wait-duration=1s
resilience4j.retry.instances.productService.retry-exceptions=java.lang.RuntimeException,java.lang.Exception
resilience4j.retry.instances.productService.ignore-exceptions=java.lang.IllegalArgumentException

# Configuración específica de Retry para similarProductsService
resilience4j.retry.instances.similarProductsService.max-attempts=2
resilience4j.retry.instances.similarProductsService.wait-duration=2s
resilience4j.retry.instances.similarProductsService.retry-exceptions=java.lang.RuntimeException,java.lang.Exception
resilience4j.retry.instances.similarProductsService.ignore-exceptions=java.lang.IllegalArgumentException

# Configuración de Time Limiter
resilience4j.timelimiter.configs.default.timeout-duration=5s
resilience4j.timelimiter.configs.default.cancel-running-future=true

# Configuración específica de Time Limiter para productService
resilience4j.timelimiter.instances.productService.timeout-duration=5s
resilience4j.timelimiter.instances.productService.cancel-running-future=true

# Configuración específica de Time Limiter para similarProductsService
resilience4j.timelimiter.instances.similarProductsService.timeout-duration=8s
resilience4j.timelimiter.instances.similarProductsService.cancel-running-future=true

# Configuración de métricas para monitoreo
management.endpoints.web.exposure.include=health,info,metrics,circuitbreakers,retries,timelimiters,ratelimiters
management.endpoint.health.show-details=when-authorized
management.endpoint.health.show-components=always

# =============================================================================
# CONFIGURACIÓN DE SECRETS Y SEGURIDAD
# =============================================================================

# Configuración de seguridad usando variables de entorno
app.security.api-key=${API_KEY:default-dev-api-key}
app.security.jwt-secret=${JWT_SECRET:default-jwt-secret-key-change-in-production}
app.security.token-expiration=${TOKEN_EXPIRATION:3600}
app.security.refresh-token-expiration=${REFRESH_TOKEN_EXPIRATION:604800}
app.security.jwt-algorithm=${JWT_ALGORITHM:HS256}
app.security.jwt-issuer=${JWT_ISSUER:product-api}
app.security.jwt-audience=${JWT_AUDIENCE:product-users}

# Configuración de rate limiting
app.security.rate-limit.max-requests-per-minute=${RATE_LIMIT_MAX_PER_MINUTE:100}
app.security.rate-limit.max-requests-per-hour=${RATE_LIMIT_MAX_PER_HOUR:1000}
app.security.rate-limit.block-time-seconds=${RATE_LIMIT_BLOCK_TIME:300}

# Configuración de CORS
app.security.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:8080}
app.security.cors.allowed-methods=${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS}
app.security.cors.allowed-headers=${CORS_ALLOWED_HEADERS:*}
app.security.cors.allow-credentials=${CORS_ALLOW_CREDENTIALS:true}
app.security.cors.max-age-seconds=${CORS_MAX_AGE:3600}

# =============================================================================
# CONFIGURACIÓN DE SERVICIOS EXTERNOS
# =============================================================================

# Servicio de recomendación
app.external.recommendation.base-url=${RECOMMENDATION_SERVICE_URL:http://localhost:8081}
app.external.recommendation.api-key=${RECOMMENDATION_API_KEY:default-recommendation-api-key}
app.external.recommendation.connection-timeout=${RECOMMENDATION_CONNECTION_TIMEOUT:5000}
app.external.recommendation.read-timeout=${RECOMMENDATION_READ_TIMEOUT:10000}
app.external.recommendation.max-retries=${RECOMMENDATION_MAX_RETRIES:3}
app.external.recommendation.retry-delay=${RECOMMENDATION_RETRY_DELAY:1000}

# Servicio de análisis
app.external.analytics.base-url=${ANALYTICS_SERVICE_URL:http://localhost:8082}
app.external.analytics.api-key=${ANALYTICS_API_KEY:default-analytics-api-key}
app.external.analytics.connection-timeout=${ANALYTICS_CONNECTION_TIMEOUT:3000}
app.external.analytics.read-timeout=${ANALYTICS_READ_TIMEOUT:5000}
app.external.analytics.enabled=${ANALYTICS_ENABLED:true}

# Servicio de notificación
app.external.notification.base-url=${NOTIFICATION_SERVICE_URL:http://localhost:8083}
app.external.notification.api-key=${NOTIFICATION_API_KEY:default-notification-api-key}
app.external.notification.connection-timeout=${NOTIFICATION_CONNECTION_TIMEOUT:2000}
app.external.notification.read-timeout=${NOTIFICATION_READ_TIMEOUT:3000}
app.external.notification.enabled=${NOTIFICATION_ENABLED:true}

# Configuración de email
app.external.notification.email.smtp-host=${SMTP_HOST:smtp.gmail.com}
app.external.notification.email.smtp-port=${SMTP_PORT:587}
app.external.notification.email.smtp-username=${SMTP_USERNAME:noreply@product-api.com}
app.external.notification.email.smtp-password=${SMTP_PASSWORD:default-email-password}
app.external.notification.email.use-tls=${SMTP_USE_TLS:true}

# Configuración de SMS
app.external.notification.sms.api-key=${SMS_API_KEY:default-sms-api-key}
app.external.notification.sms.service-url=${SMS_SERVICE_URL:https://api.twilio.com}
app.external.notification.sms.from-number=${SMS_FROM_NUMBER:+1234567890}
